<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NeonRadio — Радио нового поколения</title>
<style>
  /* ... ваш CSS без изменений ... */
</style>
</head>
<body>
  <div class="app">
    <header>
      NeonRadio
      <div class="burger-btn" id="burgerBtn" aria-label="Меню" role="button" tabindex="0">
        <span></span><span></span><span></span>
      </div>
    </header>

    <div class="side-panel" id="sidePanel" aria-hidden="true">
      <div class="close-btn" id="closeBtn" aria-label="Закрыть меню" role="button" tabindex="0">&times;</div>
      <div class="voice-control">
        <button id="voiceToggleBtn">Включить голосовое управление</button>
        <div class="voice-status" id="voiceStatus">Голосовое управление выключено</div>
      </div>
    </div>

    <div class="radio-container" id="radioContainer">
      <!-- Пример радиостанций -->
      <div class="station" data-url="http://radio.mediacdn.ru/radio/zvezda/zvezda_96"><h2>Радио Звезда</h2><div class="star-btn">&#9734;</div><div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><div class="controls"><button class="btn playBtn">▶️ Play</button><button class="btn pauseBtn" style="display:none;">⏸️ Pause</button></div></div>
      <div class="station" data-url="http://109.239.133.141:8000/krasnoyarsk-48.aac"><h2>Europa Plus</h2><div class="star-btn">&#9734;</div><div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><div class="controls"><button class="btn playBtn">▶️ Play</button><button class="btn pauseBtn" style="display:none;">⏸️ Pause</button></div></div>
      <div class="station" data-url="http://online-1.gkvr.ru:8000/novoe_kra_64onair.aac"><h2>Новое Радио</h2><div class="star-btn">&#9734;</div><div class="visualizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><div class="controls"><button class="btn playBtn">▶️ Play</button><button class="btn pauseBtn" style="display:none;">⏸️ Pause</button></div></div>
    </div>
  </div>

<script>
  // Инициализация элементов
  const burgerBtn = document.getElementById('burgerBtn'),
        sidePanel = document.getElementById('sidePanel'),
        closeBtn = document.getElementById('closeBtn'),
        radioContainer = document.getElementById('radioContainer'),
        stations = Array.from(document.querySelectorAll('.station')),
        voiceToggleBtn = document.getElementById('voiceToggleBtn'),
        voiceStatus = document.getElementById('voiceStatus');

  let currentAudio = null;
  let currentStation = null;
  let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));

  // Меню
  burgerBtn.addEventListener('click', () => {
    sidePanel.classList.add('open');
    sidePanel.setAttribute('aria-hidden', 'false');
  });
  closeBtn.addEventListener('click', () => {
    sidePanel.classList.remove('open');
    sidePanel.setAttribute('aria-hidden', 'true');
  });

  // Избранное
  stations.forEach(station => {
    const starBtn = station.querySelector('.star-btn'),
          name = station.querySelector('h2').textContent;
    if (favorites.has(name)) starBtn.classList.add('favorited'), starBtn.textContent = '★';
    starBtn.addEventListener('click', () => {
      if (favorites.has(name)) { favorites.delete(name); starBtn.classList.remove('favorited'); starBtn.textContent = '☆'; }
      else { favorites.add(name); starBtn.classList.add('favorited'); starBtn.textContent = '★'; }
      localStorage.setItem('favorites', JSON.stringify(Array.from(favorites)));
    });
  });

  // Плей/Пауза
  stations.forEach(station => {
    const playBtn = station.querySelector('.playBtn'),
          pauseBtn = station.querySelector('.pauseBtn');

    playBtn.addEventListener('click', () => {
      if (currentAudio) { currentAudio.pause(); resetBtns(currentStation); }
      currentAudio = new Audio(station.dataset.url);
      currentAudio.volume = currentAudio.volume || 0.5;
      currentAudio.play().catch(console.warn);
      currentStation = station;
      togglePlayPause(station, true);
    });

    pauseBtn.addEventListener('click', () => {
      if (currentAudio) { currentAudio.pause(); }
      togglePlayPause(station, false);
      currentAudio = currentStation = null;
    });
  });

  function resetBtns(station) {
    station.querySelector('.playBtn').style.display = 'inline-block';
    station.querySelector('.pauseBtn').style.display = 'none';
  }
  function togglePlayPause(station, playing) {
    station.querySelector('.playBtn').style.display = playing ? 'none' : 'inline-block';
    station.querySelector('.pauseBtn').style.display = playing ? 'inline-block' : 'none';
  }

  // Автопауза при листании
  radioContainer.addEventListener('scroll', () => {
    if (!currentStation) return;
    const rect = currentStation.getBoundingClientRect(),
          cont = radioContainer.getBoundingClientRect();
    if (!(rect.top >= cont.top && rect.bottom <= cont.bottom)) {
      currentAudio.pause();
      resetBtns(currentStation);
      currentAudio = currentStation = null;
    }
  });

  // Голосовое управление
  let recognition = null, recognizing = false;

  function initSpeechRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      voiceStatus.textContent = 'Голосовое управление не поддерживается';
      voiceToggleBtn.disabled = true;
      return null;
    }
    const rec = new SpeechRecognition();
    rec.lang = 'ru-RU';
    rec.continuous = true;
    rec.interimResults = false;
    return rec;
  }

  function processCommand(command) {
    command = command.toLowerCase();
    console.log('Распознано:', command);

    // Базовые команды
    if (/(включи радио|старт)/.test(command)) {
      if (!currentStation && stations.length) stations[0].querySelector('.playBtn').click(), voiceStatus.textContent = 'Радио включено'; return;
    }
    if (/(выключи радио|стоп)/.test(command)) {
      if (currentAudio) {
        currentAudio.pause();
        resetBtns(currentStation);
        currentAudio = currentStation = null;
        voiceStatus.textContent = 'Радио выключено';
      }
      return;
    }
    // Следующая / предыдущая
    if (/(следующ|далее)/.test(command)) { changeStation(1, 'Следующая станция'); return; }
    if (/(предыдущ|назад)/.test(command)) { changeStation(-1, 'Предыдущая станция'); return; }

    // Громкость
    if (command.includes('громче')) { if (currentAudio) currentAudio.volume = Math.min(currentAudio.volume + 0.1, 1); voiceStatus.textContent = 'Громкость увеличена'; return; }
    if (command.includes('тише'))  { if (currentAudio) currentAudio.volume = Math.max(currentAudio.volume - 0.1, 0); voiceStatus.textContent = 'Громкость уменьшена'; return; }

    // Пауза / продолжить
    if (command.includes('пауза'))   { if (currentAudio && !currentAudio.paused) currentAudio.pause(), voiceStatus.textContent = 'Пауза'; return; }
    if (/(продолжи|продолжить)/.test(command)) { if (currentAudio && currentAudio.paused) currentAudio.play(), voiceStatus.textContent = 'Продолжено'; return; }

    // Добавление/удаление избранного
    if (/(избранн|добавь|убери)/.test(command)) {
      if (!currentStation) { voiceStatus.textContent = 'Сначала выберите станцию'; return; }
      const star = currentStation.querySelector('.star-btn');
      star.click();
      voiceStatus.textContent = star.classList.contains('favorited') ? 'Добавлено в избранное' : 'Удалено из избранного';
      return;
    }

    // Включить по названию
    for (const st of stations) {
      const name = st.querySelector('h2').textContent.toLowerCase();
      if (command.includes(name.toLowerCase())) {
        st.querySelector('.playBtn').click();
        st.scrollIntoView({behavior:'smooth', block:'start'});
        voiceStatus.textContent = `Воспроизвожу: ${st.querySelector('h2').textContent}`;
        return;
      }
    }

    voiceStatus.textContent = 'Команда не распознана';
  }

  function changeStation(delta, statusText) {
    if (!currentStation) return;
    let idx = stations.indexOf(currentStation);
    let next = (idx + delta + stations.length) % stations.length;
    stations[next].querySelector('.playBtn').click();
    stations[next].scrollIntoView({behavior:'smooth', block:'start'});
    voiceStatus.textContent = statusText;
  }

  voiceToggleBtn.addEventListener('click', () => {
    if (!recognition) {
      recognition = initSpeechRecognition();
      if (!recognition) return;
      recognition.onresult = e => processCommand(e.results[e.results.length-1][0].transcript.trim());
      recognition.onerror = e => voiceStatus.textContent = 'Ошибка: ' + e.error;
      recognition.onend = () => recognizing && recognition.start();
    }
    if (!recognizing) {
      recognition.start();
      recognizing = true;
      voiceToggleBtn.classList.add('active');
      voiceStatus.textContent = 'Голосовое управление активно...';
    } else {
      recognition.stop();
      recognizing = false;
      voiceToggleBtn.classList.remove('active');
      voiceStatus.textContent = 'Голосовое управление выключено';
    }
  });
</script>
</body>
</html>
